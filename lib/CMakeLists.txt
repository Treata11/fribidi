# fribidi-config.h generation
set(FRIBIDI_CONFIG_H_CONTENT "
/* fribidi-config.h generated by CMake */
#define PACKAGE \"${PROJECT_NAME}\"
#define PACKAGE_NAME \"GNU FriBidi\"
#define PACKAGE_BUGREPORT \"https://github.com/fribidi/fribidi/issues/new\"
#define FRIBIDI_VERSION \"${PROJECT_VERSION}\"
#define FRIBIDI_MAJOR_VERSION ${PROJECT_VERSION_MAJOR}
#define FRIBIDI_MINOR_VERSION ${PROJECT_VERSION_MINOR}
#define FRIBIDI_MICRO_VERSION ${PROJECT_VERSION_PATCH}
#define FRIBIDI_INTERFACE_VERSION ${INTERFACE_VERSION}
#define SIZEOF_INT ${CMAKE_SIZEOF_INT}
")
if(MSVC)
    set(FRIBIDI_CONFIG_H_CONTENT "${FRIBIDI_CONFIG_H_CONTENT}
#define FRIBIDI_BUILT_WITH_MSVC")
else()
    set(FRIBIDI_CONFIG_H_CONTENT "${FRIBIDI_CONFIG_H_CONTENT}
#undef FRIBIDI_BUILT_WITH_MSVC")
endif()
file(WRITE ${CMAKE_CURRENT_BINARY_DIR}/fribidi-config.h "${FRIBIDI_CONFIG_H_CONTENT}")

# Headers
set(FRIBIDI_HEADERS
    fribidi-arabic.h
    fribidi-begindecls.h
    fribidi-bidi.h
    fribidi-bidi-types.h
    fribidi-bidi-types-list.h
    fribidi-char-sets.h
    fribidi-char-sets-list.h
    fribidi-common.h
    fribidi-deprecated.h
    fribidi-enddecls.h
    fribidi-flags.h
    fribidi-joining.h
    fribidi-joining-types.h
    fribidi-joining-types-list.h
    fribidi-mirroring.h
    fribidi-brackets.h
    fribidi-shape.h
    fribidi-types.h
    fribidi-unicode.h
    fribidi.h
)
install(FILES ${FRIBIDI_HEADERS} DESTINATION include/fribidi)

# Sources
set(FRIBIDI_SOURCES
    fribidi.c
    fribidi-arabic.c
    fribidi-bidi.c
    fribidi-bidi-types.c
    fribidi-char-sets.c
    fribidi-char-sets-cap-rtl.c
    fribidi-char-sets-cp1255.c
    fribidi-char-sets-cp1256.c
    fribidi-char-sets-iso8859-6.c
    fribidi-char-sets-iso8859-8.c
    fribidi-char-sets-utf8.c
    fribidi-deprecated.c
    fribidi-joining.c
    fribidi-joining-types.c
    fribidi-mirroring.c
    fribidi-brackets.c
    fribidi-run.c
    fribidi-shape.c
)

add_library(fribidi 
    ${FRIBIDI_SOURCES}
    ${FRIBIDI_UNICODE_VERSION_H}
    ${CMAKE_CURRENT_BINARY_DIR}/fribidi-config.h
    ${CMAKE_BINARY_DIR}/config.h  # Changed from ${CMAKE_CURRENT_BINARY_DIR}/config.h
    ${GENERATED_TAB_INCLUDE_FILES}
)
target_include_directories(fribidi PUBLIC ${FRIBIDI_INCLUDE_DIRS})
target_compile_definitions(fribidi PRIVATE 
    HAVE_CONFIG_H 
    ${FRIBIDI_BUILD_CARGS} 
    ${FRIBIDI_STATIC_CARGS}
)
set_target_properties(fribidi PROPERTIES 
    VERSION ${LIBVERSION}
    SOVERSION ${SOVERSION}
    VISIBILITY_INLINES_HIDDEN TRUE
    C_VISIBILITY_PRESET hidden
)
add_dependencies(fribidi generate-unicode-version generate-tabs)
install(TARGETS fribidi 
    LIBRARY DESTINATION lib
    ARCHIVE DESTINATION lib
    RUNTIME DESTINATION bin
)